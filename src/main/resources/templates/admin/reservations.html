<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{fragments/head :: head}"></head>

<body>

<!-- **************** MAIN CONTENT START **************** -->
<main>
	
	<!-- Sidebar START -->
	<nav th:replace="~{admin/fragments/sidebar :: admin-sidebar}"></nav>
	<!-- Sidebar END -->
	
	<!-- Page content START -->
	<div class="page-content">
	
		<!-- Top bar START -->
		<nav class="navbar top-bar navbar-light py-0 py-xl-3">
			<div class="container-fluid p-0">
				<div class="d-flex align-items-center w-100">
	
					<!-- Logo START -->
					<div class="d-flex align-items-center d-xl-none">
						<a class="navbar-brand" th:href="@{/}">
							<img class="navbar-brand-item h-40px" th:src="@{/assets/images/logo-icon.svg}" alt="">
						</a>
					</div>
					<!-- Logo END -->
	
					<!-- Toggler for sidebar START -->
					<div class="navbar-expand-xl sidebar-offcanvas-menu">
						<button class="navbar-toggler me-auto p-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSidebar" aria-controls="offcanvasSidebar" aria-expanded="false" aria-label="Toggle navigation" data-bs-auto-close="outside">
							<i class="bi bi-list text-primary fa-fw" data-bs-target="#offcanvasMenu"></i>
						</button>
					</div>
					<!-- Toggler for sidebar END -->
					
					<!-- Top bar left -->
					<div class="navbar-expand-lg ms-auto ms-xl-0">
						<!-- Toggler for menubar START -->
						<button class="navbar-toggler ms-auto p-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTopContent" aria-controls="navbarTopContent" aria-expanded="false" aria-label="Toggle navigation">
							<i class="bi bi-search"></i>
						</button>
						<!-- Toggler for menubar END -->
	
						<!-- Topbar menu START -->
						<div class="collapse navbar-collapse w-100 z-index-1" id="navbarTopContent">
							<!-- Top search START -->
							<div class="nav my-3 my-xl-0 flex-nowrap align-items-center">
								<div class="nav-item w-100">
									<form class="position-relative">
										<input class="form-control pe-5" type="search" placeholder="Search" aria-label="Search">
										<button class="bg-transparent px-2 py-0 border-0 position-absolute top-50 end-0 translate-middle-y" type="submit"><i class="fas fa-search fs-6 text-primary"></i></button>
									</form>
								</div>
							</div>
							<!-- Top search END -->
						</div>
						<!-- Topbar menu END -->
					</div>
					<!-- Top bar left END -->
					
				<!-- Profile and Notification START -->
				<ul class="nav flex-row align-items-center list-unstyled ms-xl-auto">

					<!-- Dark mode options START -->
					<li class="nav-item dropdown ms-3">
						<button class="nav-notification btn btn-light lh-0 p-0 mb-0" id="bd-theme"
						type="button"
						aria-expanded="false"
						data-bs-toggle="dropdown"
						data-bs-display="static">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-half fa-fw theme-icon-active" viewBox="0 0 16 16">
								<path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
								<use href="#"></use>
							</svg>
						</button>

						<ul class="dropdown-menu min-w-auto dropdown-menu-end" aria-labelledby="bd-theme">
							<li class="mb-1">
								<button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="light">
									<svg width="16" height="16" fill="currentColor" class="bi bi-brightness-high-fill fa-fw mode-switch me-1" viewBox="0 0 16 16">
										<path d="M12 8a4 4 0 1 1-8 0 4 4 0 0 1 8 0zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 0 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"/>
										<use href="#"></use>
									</svg>Light
								</button>
							</li>
							<li class="mb-1">
								<button type="button" class="dropdown-item d-flex align-items-center" data-bs-theme-value="dark">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-moon-stars-fill fa-fw mode-switch me-1" viewBox="0 0 16 16">
										<path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"/>
										<path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l-.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"/>
										<use href="#"></use>
									</svg>Dark
								</button>
							</li>
							<li>
								<button type="button" class="dropdown-item d-flex align-items-center active" data-bs-theme-value="auto">
									<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-circle-half fa-fw mode-switch" viewBox="0 0 16 16">
										<path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"/>
										<use href="#"></use>
									</svg>Auto
								</button>
							</li>
						</ul>
					</li>
					<!-- Dark mode options END -->

				<!-- Profile dropdown START -->
				<li class="nav-item ms-3 dropdown">
					<!-- Avatar -->
					<a class="avatar avatar-sm p-0" href="#" id="profileDropdown" role="button" data-bs-auto-close="outside" data-bs-display="static" data-bs-toggle="dropdown" aria-expanded="false">
						<img class="avatar-img rounded-2" th:src="@{/assets/images/avatar/01.jpg}" alt="avatar">
					</a>

					<ul class="dropdown-menu dropdown-animation dropdown-menu-end shadow pt-3" aria-labelledby="profileDropdown">
						<!-- Profile info -->
						<li class="px-3 mb-3">
							<div class="d-flex align-items-center">
								<!-- Avatar -->
								<div class="avatar me-3">
									<img class="avatar-img rounded-circle shadow" th:src="@{/assets/images/avatar/01.jpg}" alt="avatar">
								</div>
								<div>
									<a class="h6 mt-2 mt-sm-0" href="#" th:text="${user != null ? user.firstname + ' ' + user.lastname : 'Admin'}">Admin</a>
									<p class="small m-0" th:text="${user != null ? user.email : 'admin@volmaghreb.com'}">admin@volmaghreb.com</p>
								</div>
							</div>
						</li>

						<!-- Links -->
						<li> <hr class="dropdown-divider"></li>
						<li><a class="dropdown-item" th:href="@{/admin/profile}"><i class="bi bi-person fa-fw me-2"></i>My Profile</a></li>
						<li><a class="dropdown-item bg-danger-soft-hover" th:href="@{/logout}"><i class="bi bi-power fa-fw me-2"></i>Sign Out</a></li>
					</ul>
				</li>
				<!-- Profile dropdown END -->
			</ul>
			<!-- Profile and Notification START -->
				</div>
			</div>
		</nav>
		<!-- Top bar END -->
	
		<!-- Content START -->
        <section>
            <div class="container vstack gap-4">
                <!-- Title START -->
                <div class="row">
                    <div class="col-12">
                        <h1 class="fs-4 mb-0"><i class="fa-solid fa-ticket fa-fw me-1"></i>Reservations</h1>
                    </div>
                </div>
                <!-- Title END -->

                <!-- Reservation table START -->
                <div class="row">
                    <div class="col-12">
                        <div class="card border">
                            <!-- Card header START -->
                            <div class="card-header border-bottom">
                                <h5 class="card-header-title">Reservations<span class="badge bg-primary bg-opacity-10 text-primary ms-2" th:text="${reservations != null ? reservations.totalElements : '0'} + ' Reservations'">0 Reservations</span></h5>
                            </div>
                            <!-- Card header END -->

                            <!-- Card body START -->
                            <div class="card-body">
                                <!-- Search and select START -->
                                <div class="row g-3 align-items-center justify-content-between mb-3">
                                    <!-- Search -->
                                    <div class="col-md-8">
                                        <form class="rounded position-relative" method="GET" th:action="@{/admin/reservations}">
                                            <input class="form-control pe-5" type="search" name="search" placeholder="Search" aria-label="Search" th:value="${param.search}">
                                            <button class="btn border-0 px-3 py-0 position-absolute top-50 end-0 translate-middle-y" type="submit"><i class="fas fa-search fs-6"></i></button>
                                        </form>
                                    </div>

                                    <!-- Select option -->
                                    <div class="col-md-3">
                                        <!-- Sort by filter -->
                                        <form method="GET" th:action="@{/admin/reservations}">
                                            <select class="form-select js-choice" name="sort" aria-label=".form-select-sm" onchange="this.form.submit()">
                                                <option value="">Sort by</option>
                                                <option value="id" th:selected="${param.sort == 'id'}">Reservation ID</option>
                                                <option value="user" th:selected="${param.sort == 'user'}">User</option>
                                                <option value="date" th:selected="${param.sort == 'date'}">Date</option>
                                                <option value="status" th:selected="${param.sort == 'status'}">Status</option>
                                            </select>
                                        </form>
                                    </div>
                                </div>
                                <!-- Search and select END -->

                                <!-- No reservations message -->
                                <div th:if="${reservations == null or reservations.empty}" class="alert alert-info text-center">
                                    <i class="fa-solid fa-info-circle fa-fw me-2"></i>
                                    <span>No reservations found.</span>
                                </div>

                                <!-- Reservation list START -->
                                <div th:if="${reservations != null and !reservations.empty}" class="table-responsive border-0">
                                    <table class="table align-middle p-4 mb-0 table-hover table-shrink">
                                        <!-- Table head -->
                                        <thead class="table-light">
                                            <tr>
                                                <th scope="col" class="border-0 rounded-start">#</th>
                                                <th scope="col" class="border-0">Reservation ID</th>
                                                <th scope="col" class="border-0">User</th>
                                                <th scope="col" class="border-0">Flight</th>
                                                <th scope="col" class="border-0">Traveler</th>
                                                <th scope="col" class="border-0">Departure Date</th>
                                                <th scope="col" class="border-0">Status</th>
                                                <th scope="col" class="border-0 rounded-end">Action</th>
                                            </tr>
                                        </thead>

                                        <!-- Table body START -->
                                        <tbody class="border-top-0">
                                            <tr th:each="reservation, iterStat : ${reservations}">
                                                <td><h6 class="mb-0" th:text="${iterStat.index + 1 + (reservations.number * reservations.size)}">01</h6></td>
                                                <td><h6 class="mb-0"><a href="#" th:text="${reservation.reservationNumber}" data-bs-toggle="modal" th:attr="data-bs-target=${'#viewModal' + reservation.id}">CGDSUAHA12548</a></h6></td>
                                                <td th:text="${reservation.userFirstname != null && reservation.userLastname != null ? reservation.userFirstname + ' ' + reservation.userLastname : (reservation.userEmail != null ? reservation.userEmail : 'User ID: ' + reservation.userId)}">User Name</td>
                                                <td th:text="${reservation.flight != null && reservation.flight.originAirport != null && reservation.flight.destinationAirport != null ? reservation.flight.originAirport.city + ' (' + reservation.flight.originAirport.iataCode + ') to ' + reservation.flight.destinationAirport.city + ' (' + reservation.flight.destinationAirport.iataCode + ')' : (reservation.flight != null && reservation.flight.flightNumber != null ? reservation.flight.flightNumber : 'N/A')}">Flight Route</td>
                                                <td th:text="${reservation.travelerName != null ? reservation.travelerName : (reservation.travelerFirstname != null && reservation.travelerLastname != null ? reservation.travelerFirstname + ' ' + reservation.travelerLastname : 'N/A')}">Traveler Name</td>
                                                <td><h6 class="mb-0 fw-light" th:text="${reservation.flight != null && reservation.flight.departureDateTime != null ? #temporals.format(reservation.flight.departureDateTime, 'MMM dd, yyyy HH:mm') : 'N/A'}">Departure Date</h6></td>
                                                <td>
                                                    <div class="badge" th:classappend="${reservation.status.name() == 'CONFIRMED' ? 'text-bg-success' : (reservation.status.name() == 'CANCELLED' ? 'text-bg-danger' : 'text-bg-warning')}" th:text="${reservation.status}">Confirmed</div>
                                                </td>
                                                <td><a href="#" class="d-flex btn btn-sm btn-light mb-0" data-bs-toggle="modal" th:attr="data-bs-target=${'#viewModal' + reservation.id}"><i class="bi bi-eye fa-fw me-1"></i>View</a></td>
                                            </tr>
                                        </tbody>
                                        <!-- Table body END -->
                                    </table>
                                </div>
                                <!-- Reservation list END -->
                            </div>
                            <!-- Card body END -->

                            <!-- Card footer START -->
                            <div th:if="${reservations != null and !reservations.empty}" class="card-footer pt-0">
                                <div class="d-sm-flex justify-content-sm-between align-items-sm-center">
                                    <p class="mb-sm-0 text-center text-sm-start">
                                        Showing <span th:text="${reservations.number * reservations.size + 1}">1</span> to 
                                        <span th:text="${reservations.number * reservations.size + reservations.numberOfElements}">3</span> of 
                                        <span th:text="${reservations.totalElements}">30</span> reservations
                                    </p>
                                    <nav class="mb-sm-0 d-flex justify-content-center" aria-label="navigation" th:if="${reservations.totalPages > 1}">
                                        <ul class="pagination pagination-sm pagination-primary-soft mb-0">
                                            <li class="page-item" th:classappend="${reservations.first ? 'disabled' : ''}">
                                                <a class="page-link" th:href="@{/admin/reservations(page=${reservations.number - 1})}" th:if="${!reservations.first}">Prev</a>
                                                <span class="page-link" th:if="${reservations.first}">Prev</span>
                                            </li>
                                            <li class="page-item" th:each="i : ${#numbers.sequence(0, reservations.totalPages - 1)}" th:classappend="${i == reservations.number ? 'active' : ''}">
                                                <a class="page-link" th:href="@{/admin/reservations(page=${i})}" th:text="${i + 1}">1</a>
                                            </li>
                                            <li class="page-item" th:classappend="${reservations.last ? 'disabled' : ''}">
                                                <a class="page-link" th:href="@{/admin/reservations(page=${reservations.number + 1})}" th:if="${!reservations.last}">Next</a>
                                                <span class="page-link" th:if="${reservations.last}">Next</span>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                            <!-- Card footer END -->
                        </div>
                    </div>
                </div> 
                <!-- Reservation table END -->
            </div>
        </section>
        <!-- Content END -->

        <!-- View Modal START -->
        <div th:each="reservation : ${reservations}">
            <div class="modal fade" th:id="${'viewModal' + reservation.getId()}" tabindex="-1" th:attr="aria-labelledby='viewModalLabel' + ${reservation.getId()}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" th:id="${'viewModalLabel' + reservation.getId()}">Reservation Details - <span th:text="${reservation.getReservationNumber()}"></span></h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row g-4">
                                <!-- Basic Information -->
                                <div class="col-md-6">
                                    <h6 class="mb-3">Basic Information</h6>
                                    <div class="bg-light p-3 rounded">
                                        <div class="row g-2">
                                            <div class="col-sm-4"><strong>Reservation #:</strong></div>
                                            <div class="col-sm-8" th:text="${reservation.getReservationNumber()}">CGDSUAHA12548</div>
                                            <div class="col-sm-4"><strong>Status:</strong></div>
                                            <div class="col-sm-8">
                                                <span class="badge" th:classappend="${reservation.status.name() == 'CONFIRMED' ? 'text-bg-success' : (reservation.status.name() == 'CANCELLED' ? 'text-bg-danger' : 'text-bg-warning')}" th:text="${reservation.status}">Confirmed</span>
                                            </div>
                                            <div class="col-sm-4"><strong>Date:</strong></div>
                                            <div class="col-sm-8" th:text="${reservation.reservationDateTime != null ? #temporals.format(reservation.reservationDateTime, 'MMM dd, yyyy HH:mm') : 'N/A'}">N/A</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Passenger Information -->
                                <div class="col-md-6">
                                    <h6 class="mb-3">Passenger Information</h6>
                                    <div class="bg-light p-3 rounded">
                                        <div class="row g-2">
                                            <div class="col-sm-4"><strong>Name:</strong></div>
                                            <div class="col-sm-8" th:text="${reservation.travelerName != null ? reservation.travelerName : (reservation.travelerFirstname != null && reservation.travelerLastname != null ? reservation.travelerFirstname + ' ' + reservation.travelerLastname : 'N/A')}">N/A</div>
                                            <div class="col-sm-4"><strong>Email:</strong></div>
                                            <div class="col-sm-8" th:text="${reservation.userEmail != null ? reservation.userEmail : 'N/A'}">N/A</div>
                                            <div class="col-sm-4"><strong>Seat:</strong></div>
                                            <div class="col-sm-8" th:text="${reservation.seatNumber != null ? reservation.seatNumber : 'N/A'}">N/A</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Flight Information -->
                                <div class="col-12">
                                    <h6 class="mb-3">Flight Information</h6>
                                    <div class="bg-light p-3 rounded">
                                        <div class="row g-2">
                                            <div class="col-sm-2"><strong>Flight:</strong></div>
                                            <div class="col-sm-4" th:text="${reservation.flight != null && reservation.flight.flightNumber != null ? reservation.flight.flightNumber : 'N/A'}">N/A</div>
                                            <div class="col-sm-2"><strong>Route:</strong></div>
                                            <div class="col-sm-4" th:text="${reservation.flight != null && reservation.flight.originAirport != null && reservation.flight.destinationAirport != null ? reservation.flight.originAirport.city + ' (' + reservation.flight.originAirport.iataCode + ') → ' + reservation.flight.destinationAirport.city + ' (' + reservation.flight.destinationAirport.iataCode + ')' : 'N/A'}">N/A</div>
                                            <div class="col-sm-2"><strong>Departure:</strong></div>
                                            <div class="col-sm-4" th:text="${reservation.flight != null && reservation.flight.departureDateTime != null ? #temporals.format(reservation.flight.departureDateTime, 'MMM dd, yyyy HH:mm') : 'N/A'}">N/A</div>
                                            <div class="col-sm-2"><strong>Arrival:</strong></div>
                                            <div class="col-sm-4" th:text="${reservation.flight != null && reservation.flight.arrivalDateTime != null ? #temporals.format(reservation.flight.arrivalDateTime, 'MMM dd, yyyy HH:mm') : 'N/A'}">N/A</div>
                                            <div class="col-sm-2"><strong>Class:</strong></div>
                                            <div class="col-sm-4" th:text="${reservation.seatClass != null ? reservation.seatClass : 'N/A'}">N/A</div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Payment Information -->
                                <div class="col-12">
                                    <h6 class="mb-3">Payment Information</h6>
                                    <div class="bg-light p-3 rounded">
                                        <div class="row g-2">
                                            <div class="col-sm-2"><strong>Amount:</strong></div>
                                            <div class="col-sm-4" th:text="${reservation.paymentAmount != null ? reservation.paymentAmount + ' MAD' : 'N/A'}">N/A</div>
                                            <div class="col-sm-2"><strong>Status:</strong></div>
                                            <div class="col-sm-4">
                                                <span class="badge" th:classappend="${reservation.paymentStatus != null && reservation.paymentStatus.toUpperCase() == 'PAID' ? 'text-bg-success' : (reservation.paymentStatus != null && reservation.paymentStatus.toUpperCase() == 'FAILED' ? 'text-bg-danger' : 'text-bg-warning')}" th:text="${reservation.paymentStatus != null ? reservation.paymentStatus : 'N/A'}">N/A</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- View Modal END -->
	</div>
	<!-- Page content END -->
	
	</main>
<!-- **************** MAIN CONTENT END **************** -->

<!-- Bootstrap JS -->
<script th:src="@{/assets/vendor/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>

<!-- Vendor -->
<script th:src="@{/assets/vendor/overlay-scrollbar/js/overlayscrollbars.min.js}"></script>
<script th:src="@{/assets/vendor/apexcharts/js/apexcharts.min.js}"></script>

<!-- ThemeFunctions -->
<script th:src="@{/assets/js/functions.js}"></script>

</body>

</html>
